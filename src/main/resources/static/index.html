<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Vendo-Matic 800 Demo</title>
    <style>
        body{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b0f14;color:#e6edf3;margin:0}
        #term{max-width:820px;margin:24px auto;padding:16px;border:1px solid #1f2937;border-radius:12px;background:#0f1720}
        .line{white-space:pre-wrap;margin:6px 0}
        input{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#111827;color:#e6edf3}
        button{padding:8px 12px;margin-right:8px;border-radius:8px;border:1px solid #334155;background:#111827;color:#e6edf3;cursor:pointer}
    </style>
</head>
<body>
<div id="term">
    <div class="line">Vendo-Matic 800 (Online Demo)</div>
    <div class="line" id="balance"></div>
    <div class="line">
        <button id="show">Show Items</button>
        <button id="finish">Finish</button>
        <button id="reset">Reset</button>
    </div>
    <div class="line">Feed $: <input id="feed" placeholder="1 / 2 / 5 / 10"/></div>
    <div class="line">Select Code: <input id="code" placeholder="A1 / B2 / C3 / D4"/></div>
    <div id="out"></div>
</div>
<script>
    const $ = s => document.querySelector(s);
    const out = $('#out');
    function log(s){const d=document.createElement('div');d.className='line';d.textContent=s;out.prepend(d);}
    async function bal(){const t=await (await fetch('/api/balance')).text();$('#balance').textContent='Current Money: $'+t;}
    $('#show').onclick = async () => {
      const items = await (await fetch('/api/items')).json();
      log('--- Items ---');
      items.forEach(i => {
        const left = i.quantity > 0 ? i.quantity : 'SOLD OUT';
        log(`${i.slot} | ${i.name} $${i.price} (${left})`);
      });
    };
    $('#finish').onclick = async () => {
      const c = await (await fetch('/api/finish',{method:'POST'})).json();
      log(`Change -> Q:${c.quarters} D:${c.dimes} N:${c.nickels}`);
      await bal();
    };
    $('#reset').onclick = async () => {
      await fetch('/api/reset',{method:'POST'});
      log('Machine reset.');
      await bal();
    };
    $('#feed').addEventListener('keydown', async e => {
      if (e.key === 'Enter') {
        const v = e.target.value.trim();
        if (!v) return;
        await fetch('/api/feed?amount='+encodeURIComponent(v),{method:'POST'});
        log('Feed $' + v);
        e.target.value = '';
        await bal();
      }
    });
    $('#code').addEventListener('keydown', async e => {
      if (e.key === 'Enter') {
        const c = e.target.value.trim();
        if (!c) return;
        const r = await (await fetch('/api/select/'+encodeURIComponent(c),{method:'POST'})).json();
        if (r.ok) {
          log(`Dispensed: ${r.itemName} | $${r.price} | ${r.message}`);
        } else {
          log('Error: ' + r.error);
        }
        e.target.value = '';
        await bal();
      }
    });
    bal();
</script>
</body>
</html>